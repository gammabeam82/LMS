{% extends 'base.html.twig' %}

{% form_theme form 'bootstrap_3_horizontal_layout.html.twig' %}
{% form_theme comment_form 'bootstrap_3_layout.html.twig' %}

{% block title %}{{ book.name }}{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	<link rel="stylesheet" href="{{ asset('assets/vendor/chosen-bootstrap/chosen.bootstrap.min.css') }}"/>
{% endblock %}

{% block body %}
	<div class="container-fluid">

		<div class="row">
			<div class="col-xs-12">
				<ol class="breadcrumb">
					<li>
						<a href="{{ path('books', { 'reset': true }) }}">{{ 'navigation.books' | trans }}</a>
					</li>
					<li>
						<a href="{{ path('books', {'book_filter[author][]': book.author.id}) }}">{{ book.author.shortName }}</a>
					</li>
					<li class="active">{{ book.name }}</li>
				</ol>
			</div>
		</div>

		<div class="row">
			<div class="col-xs-3 bordered-right">
				<dl class="dl-horizontal">
					<dt>{{ 'book.author' | trans }}:</dt>
					<dd>{{ book.author.fullName }}</dd>
					<dt>{{ 'book.name' | trans }}:</dt>
					<dd>{{ book.name }}</dd>
					<dt>{{ 'book.date' | trans }}:</dt>
					<dd>{{ book.createdAt | date("d.m.Y H:i") }}</dd>
					<dt>{{ 'book.downloads' | trans }}:</dt>
					<dd>{{ book.views }}</dd>
					<dt>{{ 'book.rating' | trans }}:</dt>
					<dd>{{ book.averageRating }}</dd>
				</dl>
				<a href="{{ path('books_download', {'id': book.id}) }}" class="btn btn-success pull-right">
					<i class="glyphicon glyphicon-cloud-download"></i> {{ 'book.download' | trans }}
				</a>

				<br/>
				<br/>
				<hr/>

				{% for flash_message in app.session.flashBag.get('notice') %}
					<div class="panel panel-default">
						<div class="panel-body bg-success">
							{{ flash_message }}
						</div>
					</div>
				{% endfor %}

				{{ form_start(form) }}
				{{ form_row(form.value, {'attr': {'class': 'chosen-select', 'data-placeholder': ' '} }) }}

				<button type="submit" class="btn btn-primary pull-right">
					<i class="glyphicon glyphicon-star"></i> {{ 'book.rate' | trans }}
				</button>

				{{ form_end(form) }}

				{% if book.annotation %}
					<br/>
					<br/>
					<hr/>

					<p class="lead bg-info">{{ 'book.annotation' | trans }}</p>
					<p>
						{{ book.annotation }}
					</p>
				{% endif %}

			</div>

			<div class="col-xs-8">
				{% for flash_message in app.session.flashBag.get('notice.comment') %}
					<div class="panel panel-default">
						<div class="panel-body bg-success">
							{{ flash_message }}
						</div>
					</div>
				{% endfor %}
				{{ form_start(comment_form) }}
				{{ form_row(comment_form.message, { 'attr': { 'rows': 6 } }) }}

				<div class="progress" data-min="{{ commentLength.min }}" data-max="{{ commentLength.max }}">
					<div class="progress-bar progress-bar-danger progress-bar-striped" role="progressbar" style="width: 6%">
						0
					</div>
				</div>

				<button type="submit" class="btn btn-default pull-right">
					<i class="glyphicon glyphicon-plus"></i> {{ 'actions.save' | trans }}
				</button>

				{{ form_end(comment_form) }}

				<div>
					<br/>
					<br/>
					<br/>
					{% for comment in comments %}
						<div class="panel panel-default" id="c{{ comment.id }}">
							<div class="panel-heading">
								<i class="glyphicon glyphicon-user"></i> {{ comment.user.username }}
								<span class="pull-right text-muted">
									<i class="glyphicon glyphicon-time"></i> {{ comment.postedAt | date('d.m.Y H:i:s') }}
								</span>
							</div>
							<div class="panel-body">
								{{ comment.message }}
							</div>
						</div>
					{% endfor %}

					<div class="navigation">
						{{ knp_pagination_render(comments) }}
					</div>

				</div>

			</div>

		</div>

	</div>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script src="{{ asset('assets/vendor/chosen/chosen.jquery.js') }}"></script>
	<script src="{{ asset('assets/js/books-view.js') }}"></script>
{% endblock %}